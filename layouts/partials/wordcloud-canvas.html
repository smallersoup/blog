<style>
  #wordcloud {
      text-align: center;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
  }

  .word {
      position: relative;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      padding: 8px 16px;
      display: inline-block;
      margin: 4px;
      border-radius: 5px;
      transition: all 0.3s ease;
      text-decoration: none; /* Assuming each word is a link */
  }

  /* 角标样式 */
  .badge {
      position: absolute;
      top: 0;
      right: 0;
      padding: 2px 5px;
      font-size: 0.7em;
      border-radius: 50%;
      transform: translate(50%, -50%);
  }

  /* 多种颜色 */
  .color-1 { color: rgba(var(--color-primary-700), 1); .dark & { color: #8be9fd; }}
  .color-2 { color: rgba(var(--color-neutral-700), 1); .dark & { color: rgba(var(--color-neutral-200), 1); }}
  .color-3 { color: #8B4513; .dark & { color: #ffb86c; }}
  .color-4 { color: #00668c; .dark & { color: #cee8ff; }}
  .color-5 { color: #313d44; .dark & { color: #bd93f9; }}
  /* ... 更多颜色 ... */
  

  /* Different sizes based on count (example) */
  .word.size-1 { font-size: 1.0em; }
  .word.size-2 { font-size: 1.2em; }
  .word.size-3 { font-size: 1.4em; }
  .word.size-4 { font-size: 1.6em; }
  .word.size-5 { font-size: 1.8em; }
</style>

<div id="wordcloud"></div>
  {{ if eq .Kind "taxonomy" }}
    {{ if or (eq .Type "tags") (eq .Type "categories") }}
      <canvas id="wordcloud-canvas" width="900" height="350"></canvas>
      <script src="/js/wordcloud2.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", function() {
        console.log("DOM fully loaded and parsed");
        // 自动生成 tags 或 categories 数据
        var words = [
          {{- if eq .Type "tags" -}}
            {{- range $key, $value := .Site.Taxonomies.tags -}}
              [
                "{{ $key }}",
                {{ len $value.Pages }},
                "{{ absLangURL (print "/tags/" ($key | urlize)) }}"
              ],
            {{- end -}}
          {{- else if eq .Type "categories" -}}
            {{- range $key, $value := .Site.Taxonomies.categories -}}
              [
                "{{ $key }}",
                {{ len $value.Pages }},
                "{{ absLangURL (print "/categories/" ($key | urlize)) }}"
              ],
            {{- end -}}
          {{- end -}}
        ];
        // 生成词云
        WordCloud(document.getElementById('wordcloud-canvas'), {
          list: words.map(function(item){ return [item[0], item[1], item[2]]; }),
          gridSize: 8,
          fontFamily: 'Helvetica Neue, Arial, sans-serif',
          // color: function(word, weight) {
          //   var colorIdx = (word.length % 5) + 1;
          //   // 取 CSS 变量
          //   switch(colorIdx) {
          //     case 1: return getComputedStyle(document.documentElement).getPropertyValue('--color-primary-700') ? 'rgba(' + getComputedStyle(document.documentElement).getPropertyValue('--color-primary-700') + ',1)' : '#8be9fd';
          //     case 2: return getComputedStyle(document.documentElement).getPropertyValue('--color-neutral-700') ? 'rgba(' + getComputedStyle(document.documentElement).getPropertyValue('--color-neutral-700') + ',1)' : '#ffb86c';
          //     case 3: return '#080707';
          //     case 4: return '#030303';
          //     case 5: return '#030404';
          //     default: return '#000';
          //   }
          // },
          classes: function(word, weight) {
            // 只用于字号
            let sizeClass = 'size-' + (weight > 20 ? 5 : weight > 10 ? 4 : weight > 5 ? 3 : 2);
            // 提取 key（去掉后面的 (数字)）
            var colorIdx = (word.length % 5) + 1;
            classStr = 'word color-' + colorIdx + ' ' + sizeClass;
            console.log(classStr);
            return classStr;
          },
          weightFactor: 10, // 让字号主要由 class 控制
          backgroundColor: 'rgba(0,0,0,0)',
          click: function(item, dimension, event) {
            if(item[2]) window.location.href = item[2];
          }
        });

        console.log("WordCloud initialized");
      });
      </script>
    {{ end }}
  {{ end }}
